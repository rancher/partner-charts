suite: test image
templates:
  - templates/statefulset.yaml
  - templates/configmap.yaml

tests:
  - it: resource requests and limits are passed to init container 'configurator'
    set:
      cluster: test-cluster
      licenseKey: test-license-key
      resources:
        configurator:
          requests:
            cpu: 50m
            memory: 100Mi
          limits:
            cpu: 150m
            memory: 200Mi
    asserts:
      - template: templates/statefulset.yaml
        equal:
          path: spec.template.spec.initContainers[0].resources.requests.cpu
          value: "50m"
      - template: templates/statefulset.yaml
        equal:
          path: spec.template.spec.initContainers[0].resources.requests.memory
          value: "100Mi"
      - template: templates/statefulset.yaml
        equal:
          path: spec.template.spec.initContainers[0].resources.limits.cpu
          value: "150m"
      - template: templates/statefulset.yaml
        equal:
          path: spec.template.spec.initContainers[0].resources.limits.memory
          value: "200Mi"

  - it: resource requests and limits are passed to prometheus container
    set:
      cluster: test-cluster
      licenseKey: test-license-key
      resources:
        configurator:
          requests:
            cpu: 75m
            memory: 125Mi
          limits:
            cpu: 175m
            memory: 225Mi
    asserts:
      - template: templates/statefulset.yaml
        equal:
          path: spec.template.spec.initContainers[0].resources.requests.cpu
          value: "75m"
      - template: templates/statefulset.yaml
        equal:
          path: spec.template.spec.initContainers[0].resources.requests.memory
          value: "125Mi"
      - template: templates/statefulset.yaml
        equal:
          path: spec.template.spec.initContainers[0].resources.limits.cpu
          value: "175m"
      - template: templates/statefulset.yaml
        equal:
          path: spec.template.spec.initContainers[0].resources.limits.memory
          value: "225Mi"
