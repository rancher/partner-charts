apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  labels:
    app.kubernetes.io/name: airlock-microgateway-operator
    app.kubernetes.io/version: 4.8.3
  name: parsers.microgateway.airlock.com
spec:
  group: microgateway.airlock.com
  names:
    categories:
      - airlock-microgateway
    kind: Parser
    listKind: ParserList
    plural: parsers
    singular: parser
  scope: Namespaced
  versions:
    - name: v1alpha1
      schema:
        openAPIV3Schema:
          description: |-
            Parser defines a policy how request bodies should be parsed before being filtered e.g., by the deny rules.
            The defaults should work for most use cases, but it is possible to customize the behavior e.g., in case the upstream application uses non-standard content types for JSON messages.
          properties:
            apiVersion:
              description: |-
                APIVersion defines the versioned schema of this representation of an object.
                Servers should convert recognized schemas to the latest internal value, and
                may reject unrecognized values.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
              type: string
            kind:
              description: |-
                Kind is a string value representing the REST resource this object represents.
                Servers may infer this from the endpoint the client submits requests to.
                Cannot be updated.
                In CamelCase.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
              type: string
            metadata:
              type: object
            spec:
              description: spec defines the desired parser configuration.
              properties:
                request:
                  description: request defines the parsing for downstream requests.
                  properties:
                    custom:
                      description: custom allows configuring additional rules for parser selection.
                      properties:
                        rules:
                          description: |-
                            rules defines a custom set prepended before built-in rules of enabled request parsers.
                            Disable all built-in parsers to overrule them completely.
                          items:
                            properties:
                              action:
                                description: |-
                                  action specifies what should happen when a request condition matches.
                                  Only one of parse or skip can be set.
                                properties:
                                  parse:
                                    description: parse activates the configured parser.
                                    properties:
                                      form:
                                        description: form activates the Form parser.
                                        type: object
                                      json:
                                        description: json activates the JSON parser.
                                        type: object
                                      multipart:
                                        description: multipart activates the multipart parser.
                                        type: object
                                    type: object
                                  skip:
                                    description: skip disables any content parsing
                                    type: object
                                type: object
                              requestConditions:
                                description: requestConditions defines additional request properties which must all be matched in order for this rule to apply.
                                properties:
                                  header:
                                    description: header defines the matching headers of a request.
                                    properties:
                                      name:
                                        description: name defines the name of a header.
                                        properties:
                                          matcher:
                                            description: matcher defines the way to match a string. In comparison to a normal StringMatcher, a value is always matched ignoring the case and can't be inverted.
                                            properties:
                                              contains:
                                                description: |-
                                                  contains defines a substring match on the substring specified here. Empty contains match is not allowed, please use regex instead.
                                                  Only one of exact, prefix, suffix, regex or contains can be set.
                                                maxLength: 1024
                                                minLength: 1
                                                type: string
                                              exact:
                                                description: |-
                                                  exact defines an explicit match on the string specified here.
                                                  Only one of exact, prefix, suffix, regex or contains can be set.
                                                maxLength: 1024
                                                minLength: 1
                                                type: string
                                              prefix:
                                                description: |-
                                                  prefix defines a prefix match on the prefix specified here. Empty prefix is not allowed, please use regex instead.
                                                  Only one of exact, prefix, suffix, regex or contains can be set.
                                                maxLength: 1024
                                                minLength: 1
                                                type: string
                                              regex:
                                                description: |-
                                                  regex defines a regex match on the regular expression specified here. Google's [RE2 regex engine](https://github.com/google/re2/wiki/Syntax) is used.
                                                  The regex matches only single-line by default, even with ".*". To match a multi-line string prepend (?s) to your regex.
                                                  Only one of exact, prefix, suffix, regex or contains can be set.
                                                maxLength: 1024
                                                minLength: 1
                                                type: string
                                              suffix:
                                                description: |-
                                                  suffix defines a suffix match on the suffix specified here. Empty suffix is not allowed, please use regex instead.
                                                  Only one of exact, prefix, suffix, regex or contains can be set.
                                                maxLength: 1024
                                                minLength: 1
                                                type: string
                                            type: object
                                        required:
                                          - matcher
                                        type: object
                                      value:
                                        description: value defines the value of a header.
                                        properties:
                                          matcher:
                                            description: StringMatcher defines the way to match a string.
                                            properties:
                                              contains:
                                                description: |-
                                                  contains defines a substring match on the substring specified here. Empty contains match is not allowed, please use regex instead.
                                                  Only one of exact, prefix, suffix, regex or contains can be set.
                                                maxLength: 1024
                                                minLength: 1
                                                type: string
                                              exact:
                                                description: |-
                                                  exact defines an explicit match on the string specified here.
                                                  Only one of exact, prefix, suffix, regex or contains can be set.
                                                maxLength: 1024
                                                minLength: 1
                                                type: string
                                              ignoreCase:
                                                default: false
                                                description: ignoreCase indicates whether the matching should be case-insensitive. In case of a regex match, the regex gets wrapped with a group `(?i:...)`.
                                                type: boolean
                                              prefix:
                                                description: |-
                                                  prefix defines a prefix match on the prefix specified here. Empty prefix is not allowed, please use regex instead.
                                                  Only one of exact, prefix, suffix, regex or contains can be set.
                                                maxLength: 1024
                                                minLength: 1
                                                type: string
                                              regex:
                                                description: |-
                                                  regex defines a regex match on the regular expression specified here. Google's [RE2 regex engine](https://github.com/google/re2/wiki/Syntax) is used.
                                                  The regex matches only single-line by default, even with ".*". To match a multi-line string prepend (?s) to your regex.
                                                  Only one of exact, prefix, suffix, regex or contains can be set.
                                                maxLength: 1024
                                                minLength: 1
                                                type: string
                                              suffix:
                                                description: |-
                                                  suffix defines a suffix match on the suffix specified here. Empty suffix is not allowed, please use regex instead.
                                                  Only one of exact, prefix, suffix, regex or contains can be set.
                                                maxLength: 1024
                                                minLength: 1
                                                type: string
                                            type: object
                                        required:
                                          - matcher
                                        type: object
                                    type: object
                                  invert:
                                    default: false
                                    description: invert indicates whether the request condition should be inverted.
                                    type: boolean
                                  mediaType:
                                    description: mediaType defines the matching media type from the content-type header of a request.
                                    properties:
                                      matcher:
                                        description: |-
                                          NonInvertableCaseInsensitiveStringMatcher defines the way to match a string.
                                          In comparison to a normal StringMatcher, a value is always matched ignoring the case and can't be inverted.
                                        properties:
                                          contains:
                                            description: |-
                                              contains defines a substring match on the substring specified here. Empty contains match is not allowed, please use regex instead.
                                              Only one of exact, prefix, suffix, regex or contains can be set.
                                            maxLength: 1024
                                            minLength: 1
                                            type: string
                                          exact:
                                            description: |-
                                              exact defines an explicit match on the string specified here.
                                              Only one of exact, prefix, suffix, regex or contains can be set.
                                            maxLength: 1024
                                            minLength: 1
                                            type: string
                                          prefix:
                                            description: |-
                                              prefix defines a prefix match on the prefix specified here. Empty prefix is not allowed, please use regex instead.
                                              Only one of exact, prefix, suffix, regex or contains can be set.
                                            maxLength: 1024
                                            minLength: 1
                                            type: string
                                          regex:
                                            description: |-
                                              regex defines a regex match on the regular expression specified here. Google's [RE2 regex engine](https://github.com/google/re2/wiki/Syntax) is used.
                                              The regex matches only single-line by default, even with ".*". To match a multi-line string prepend (?s) to your regex.
                                              Only one of exact, prefix, suffix, regex or contains can be set.
                                            maxLength: 1024
                                            minLength: 1
                                            type: string
                                          suffix:
                                            description: |-
                                              suffix defines a suffix match on the suffix specified here. Empty suffix is not allowed, please use regex instead.
                                              Only one of exact, prefix, suffix, regex or contains can be set.
                                            maxLength: 1024
                                            minLength: 1
                                            type: string
                                        type: object
                                    required:
                                      - matcher
                                    type: object
                                  method:
                                    description: method defines the matching methods of a request.
                                    items:
                                      description: Method defines common HTTP methods.
                                      enum:
                                        - GET
                                        - HEAD
                                        - POST
                                        - PUT
                                        - PATCH
                                        - DELETE
                                        - CONNECT
                                        - OPTIONS
                                        - TRACE
                                      type: string
                                    maxItems: 16
                                    type: array
                                    x-kubernetes-list-type: set
                                  path:
                                    description: path defines the matching path of a request.
                                    properties:
                                      matcher:
                                        description: StringMatcher defines the way to match a string.
                                        properties:
                                          contains:
                                            description: |-
                                              contains defines a substring match on the substring specified here. Empty contains match is not allowed, please use regex instead.
                                              Only one of exact, prefix, suffix, regex or contains can be set.
                                            maxLength: 1024
                                            minLength: 1
                                            type: string
                                          exact:
                                            description: |-
                                              exact defines an explicit match on the string specified here.
                                              Only one of exact, prefix, suffix, regex or contains can be set.
                                            maxLength: 1024
                                            minLength: 1
                                            type: string
                                          ignoreCase:
                                            default: false
                                            description: ignoreCase indicates whether the matching should be case-insensitive. In case of a regex match, the regex gets wrapped with a group `(?i:...)`.
                                            type: boolean
                                          prefix:
                                            description: |-
                                              prefix defines a prefix match on the prefix specified here. Empty prefix is not allowed, please use regex instead.
                                              Only one of exact, prefix, suffix, regex or contains can be set.
                                            maxLength: 1024
                                            minLength: 1
                                            type: string
                                          regex:
                                            description: |-
                                              regex defines a regex match on the regular expression specified here. Google's [RE2 regex engine](https://github.com/google/re2/wiki/Syntax) is used.
                                              The regex matches only single-line by default, even with ".*". To match a multi-line string prepend (?s) to your regex.
                                              Only one of exact, prefix, suffix, regex or contains can be set.
                                            maxLength: 1024
                                            minLength: 1
                                            type: string
                                          suffix:
                                            description: |-
                                              suffix defines a suffix match on the suffix specified here. Empty suffix is not allowed, please use regex instead.
                                              Only one of exact, prefix, suffix, regex or contains can be set.
                                            maxLength: 1024
                                            minLength: 1
                                            type: string
                                        type: object
                                    required:
                                      - matcher
                                    type: object
                                  remoteIP:
                                    description: |-
                                      remoteIP defines the matching remote IPs of a request.
                                      Note: Depending on your setup you may need to adapt the `remoteIP` configuration in the `SidecarGateway` / `GatewayParameters` resource to ensure correct client IP detection.
                                    properties:
                                      cidrRanges:
                                        description: cidrRanges defines the IPv4 or IPv6 CIDR ranges, e.g. ``196.148.3.128/26`` or ``2001:db8::/28``.
                                        items:
                                          description: CIDRRange defines an IPv4 or IPv6 CIDR range, e.g. “196.148.3.128/26“ or “2001:db8::/28“.
                                          format: cidr
                                          maxLength: 49
                                          minLength: 1
                                          type: string
                                        maxItems: 1024
                                        minItems: 1
                                        type: array
                                        x-kubernetes-list-type: set
                                      invert:
                                        default: false
                                        description: invert indicates whether the match should be inverted.
                                        type: boolean
                                    required:
                                      - cidrRanges
                                    type: object
                                type: object
                            required:
                              - action
                              - requestConditions
                            type: object
                          maxItems: 4096
                          type: array
                          x-kubernetes-list-type: atomic
                      type: object
                    defaultContentType:
                      default: application/x-www-form-urlencoded
                      description: defaultContentType specifies the content-type header which should be injected into the request before parser selection if it is not already present and the request has a body.
                      maxLength: 128
                      minLength: 1
                      type: string
                    parsers:
                      description: parsers defines the configuration for the available content parsers.
                      properties:
                        form:
                          description: form defines the configuration for the form parser.
                          properties:
                            enable:
                              default: true
                              description: enable defines whether form payloads are inspected.
                              type: boolean
                            mediaTypePattern:
                              default: .*urlencoded.*
                              description: mediaTypePattern is a regex specifying the media types for which the request body should be treated as form arguments.
                              maxLength: 1024
                              minLength: 1
                              type: string
                          type: object
                        json:
                          description: json defines the configuration for the JSON parser.
                          properties:
                            enable:
                              default: true
                              description: enable defines whether json payloads are inspected.
                              type: boolean
                            mediaTypePattern:
                              default: .*json.*
                              description: mediaTypePattern is a regex specifying the media types for which the request body should be treated as JSON.
                              maxLength: 1024
                              minLength: 1
                              type: string
                          type: object
                        multipart:
                          description: multipart defines the configuration for the multipart parser.
                          properties:
                            enable:
                              default: true
                              description: enable defines whether multipart payloads are inspected.
                              type: boolean
                            mediaTypePattern:
                              default: .*multipart.*
                              description: mediaTypePattern is a regex specifying the media types for which the request body should be treated as a multipart payload.
                              maxLength: 1024
                              minLength: 1
                              type: string
                          type: object
                      type: object
                  type: object
              type: object
          type: object
      served: true
      storage: true
