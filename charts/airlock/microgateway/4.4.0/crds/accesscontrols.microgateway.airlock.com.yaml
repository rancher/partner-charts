apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.4
  labels:
    app.kubernetes.io/name: airlock-microgateway-operator
    app.kubernetes.io/version: 4.4.0
  name: accesscontrols.microgateway.airlock.com
spec:
  group: microgateway.airlock.com
  names:
    categories:
      - airlock-microgateway
    kind: AccessControl
    listKind: AccessControlList
    plural: accesscontrols
    singular: accesscontrol
  scope: Namespaced
  versions:
    - additionalPrinterColumns:
        - jsonPath: .metadata.creationTimestamp
          name: Age
          type: date
      name: v1alpha1
      schema:
        openAPIV3Schema:
          description: AccessControl specifies the options to perform access control with a Microgateway Engine container.
          properties:
            apiVersion:
              description: |-
                APIVersion defines the versioned schema of this representation of an object.
                Servers should convert recognized schemas to the latest internal value, and
                may reject unrecognized values.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
              type: string
            kind:
              description: |-
                Kind is a string value representing the REST resource this object represents.
                Servers may infer this from the endpoint the client submits requests to.
                Cannot be updated.
                In CamelCase.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
              type: string
            metadata:
              type: object
            spec:
              description: Specifies how the Airlock Microgateway Engine performs access control.
              properties:
                policies:
                  description: Policies configures access control policies. The first matching policy (from top to bottom) applies.
                  items:
                    properties:
                      authorization:
                        description: Authorization configures how requests are authorized. An empty object value {} disables authorization.
                        properties:
                          authentication:
                            description: Authentication specifies that clients need to be authenticated with the provided method.
                            properties:
                              oidc:
                                description: OIDC configures client authentication using OpenID Connect.
                                properties:
                                  oidcRelyingPartyRef:
                                    description: OIDCRelyingPartyRef configures how the Airlock Microgateway Engine interacts with the OpenID provider.
                                    properties:
                                      name:
                                        description: Name of the resource
                                        minLength: 1
                                        type: string
                                    required:
                                      - name
                                    type: object
                                required:
                                  - oidcRelyingPartyRef
                                type: object
                            type: object
                          deny:
                            description: Deny specifies to deny access for all requests matching this policy.
                            type: object
                          requireAll:
                            description: RequireAll specifies conditions which must all be satisfied for the request to be authorized.
                            items:
                              properties:
                                oidc:
                                  description: OIDC specifies a condition on the result of an OpenID Connect flow.
                                  properties:
                                    claim:
                                      description: Claim specifies a condition on a JWT claim.
                                      properties:
                                        name:
                                          description: Name of the claim.
                                          minLength: 1
                                          type: string
                                        value:
                                          description: |-
                                            Value of the claim. If not specified, only existence of the claim is checked (any value is allowed).

                                            Value matching is only supported if the data type of the claim is either primitive (`number`, `boolean`, `string`) or `array` of primitives.
                                            In case of a non-string value, the match will be performed against the stringified value.

                                            If the claim has an unsupported data type (e.g. `object` or `null`), its value will never match.
                                          properties:
                                            matcher:
                                              description: StringMatcher defines the way to match a string.
                                              properties:
                                                contains:
                                                  description: |-
                                                    Contains defines a substring match on the substring specified here. Empty contains match is not allowed, please use regex instead.
                                                    Only one of exact, prefix, suffix, regex or contains can be set.
                                                  minLength: 1
                                                  type: string
                                                exact:
                                                  description: |-
                                                    Exact defines an explicit match on the string specified here.
                                                    Only one of exact, prefix, suffix, regex or contains can be set.
                                                  minLength: 1
                                                  type: string
                                                ignoreCase:
                                                  default: false
                                                  description: IgnoreCase indicates whether the matching should be case-insensitive. In case of a regex match, the regex gets wrapped with a group `(?i:...)`.
                                                  type: boolean
                                                prefix:
                                                  description: |-
                                                    Prefix defines a prefix match on the prefix specified here. Empty prefix is not allowed, please use regex instead.
                                                    Only one of exact, prefix, suffix, regex or contains can be set.
                                                  minLength: 1
                                                  type: string
                                                regex:
                                                  description: |-
                                                    Regex defines a regex match on the regular expression specified here. Google's [RE2 regex engine](https://github.com/google/re2/wiki/Syntax) is used.
                                                    The regex matches only single-line by default, even with ".*". To match a multi-line string prepend (?s) to your regex.
                                                    Only one of exact, prefix, suffix, regex or contains can be set.
                                                  minLength: 1
                                                  type: string
                                                suffix:
                                                  description: |-
                                                    Suffix defines a suffix match on the suffix specified here. Empty suffix is not allowed, please use regex instead.
                                                    Only one of exact, prefix, suffix, regex or contains can be set.
                                                  minLength: 1
                                                  type: string
                                              type: object
                                          required:
                                            - matcher
                                          type: object
                                      required:
                                        - name
                                      type: object
                                  required:
                                    - claim
                                  type: object
                              required:
                                - oidc
                              type: object
                            minItems: 1
                            type: array
                          requireAny:
                            description: RequireAny specifies conditions of which at least one must be satisfied for the request to be authorized.
                            items:
                              properties:
                                oidc:
                                  description: OIDC specifies a condition on the result of an OpenID Connect flow.
                                  properties:
                                    claim:
                                      description: Claim specifies a condition on a JWT claim.
                                      properties:
                                        name:
                                          description: Name of the claim.
                                          minLength: 1
                                          type: string
                                        value:
                                          description: |-
                                            Value of the claim. If not specified, only existence of the claim is checked (any value is allowed).

                                            Value matching is only supported if the data type of the claim is either primitive (`number`, `boolean`, `string`) or `array` of primitives.
                                            In case of a non-string value, the match will be performed against the stringified value.

                                            If the claim has an unsupported data type (e.g. `object` or `null`), its value will never match.
                                          properties:
                                            matcher:
                                              description: StringMatcher defines the way to match a string.
                                              properties:
                                                contains:
                                                  description: |-
                                                    Contains defines a substring match on the substring specified here. Empty contains match is not allowed, please use regex instead.
                                                    Only one of exact, prefix, suffix, regex or contains can be set.
                                                  minLength: 1
                                                  type: string
                                                exact:
                                                  description: |-
                                                    Exact defines an explicit match on the string specified here.
                                                    Only one of exact, prefix, suffix, regex or contains can be set.
                                                  minLength: 1
                                                  type: string
                                                ignoreCase:
                                                  default: false
                                                  description: IgnoreCase indicates whether the matching should be case-insensitive. In case of a regex match, the regex gets wrapped with a group `(?i:...)`.
                                                  type: boolean
                                                prefix:
                                                  description: |-
                                                    Prefix defines a prefix match on the prefix specified here. Empty prefix is not allowed, please use regex instead.
                                                    Only one of exact, prefix, suffix, regex or contains can be set.
                                                  minLength: 1
                                                  type: string
                                                regex:
                                                  description: |-
                                                    Regex defines a regex match on the regular expression specified here. Google's [RE2 regex engine](https://github.com/google/re2/wiki/Syntax) is used.
                                                    The regex matches only single-line by default, even with ".*". To match a multi-line string prepend (?s) to your regex.
                                                    Only one of exact, prefix, suffix, regex or contains can be set.
                                                  minLength: 1
                                                  type: string
                                                suffix:
                                                  description: |-
                                                    Suffix defines a suffix match on the suffix specified here. Empty suffix is not allowed, please use regex instead.
                                                    Only one of exact, prefix, suffix, regex or contains can be set.
                                                  minLength: 1
                                                  type: string
                                              type: object
                                          required:
                                            - matcher
                                          type: object
                                      required:
                                        - name
                                      type: object
                                  required:
                                    - claim
                                  type: object
                              required:
                                - oidc
                              type: object
                            minItems: 1
                            type: array
                        type: object
                      identityPropagation:
                        description: IdentityPropagation configures how the authenticated user's identity is communicated to the protected application.
                        properties:
                          actions:
                            description: Actions specifies the propagation actions.
                            items:
                              properties:
                                identityPropagationRef:
                                  description: IdentityPropagationRef selects an IdentityPropagation to apply.
                                  properties:
                                    name:
                                      description: Name of the resource
                                      minLength: 1
                                      type: string
                                  required:
                                    - name
                                  type: object
                              required:
                                - identityPropagationRef
                              type: object
                            type: array
                          onFailure:
                            description: |-
                              OnFailure configures what should happen, if an identity propagation fails. Meaning of the possible values:
                              _Pass_: The request should be forwarded to the upstream, without including the information from the failed identity propagations.
                            enum:
                              - Pass
                            type: string
                        required:
                          - actions
                          - onFailure
                        type: object
                      requestConditions:
                        description: |-
                          RequestConditions defines additional request properties which must be matched in order for this policy to apply. A policy without request conditions will always match.

                          WARNING: There is currently a limitation that if `authentication.oidc` is configured for this policy, you must ensure that the request condition also matches logout requests and callback redirects from the OIDC Provider as configured in the OIDCRelyingParty (`pathMapping.logoutPath` / `pathMapping.redirectPath`).
                        properties:
                          header:
                            description: Header defines the matching headers of a request.
                            properties:
                              name:
                                description: Name defines the name of a header.
                                properties:
                                  matcher:
                                    description: Matcher defines the way to match a string. In comparison to a normal StringMatcher, a value is always matched ignoring the case and can't be inverted.
                                    properties:
                                      contains:
                                        description: |-
                                          Contains defines a substring match on the substring specified here. Empty contains match is not allowed, please use regex instead.
                                          Only one of exact, prefix, suffix, regex or contains can be set.
                                        minLength: 1
                                        type: string
                                      exact:
                                        description: |-
                                          Exact defines an explicit match on the string specified here.
                                          Only one of exact, prefix, suffix, regex or contains can be set.
                                        minLength: 1
                                        type: string
                                      prefix:
                                        description: |-
                                          Prefix defines a prefix match on the prefix specified here. Empty prefix is not allowed, please use regex instead.
                                          Only one of exact, prefix, suffix, regex or contains can be set.
                                        minLength: 1
                                        type: string
                                      regex:
                                        description: |-
                                          Regex defines a regex match on the regular expression specified here. Google's [RE2 regex engine](https://github.com/google/re2/wiki/Syntax) is used.
                                          The regex matches only single-line by default, even with ".*". To match a multi-line string prepend (?s) to your regex.
                                          Only one of exact, prefix, suffix, regex or contains can be set.
                                        minLength: 1
                                        type: string
                                      suffix:
                                        description: |-
                                          Suffix defines a suffix match on the suffix specified here. Empty suffix is not allowed, please use regex instead.
                                          Only one of exact, prefix, suffix, regex or contains can be set.
                                        minLength: 1
                                        type: string
                                    type: object
                                required:
                                  - matcher
                                type: object
                              value:
                                description: Value defines the value of a header.
                                properties:
                                  matcher:
                                    description: StringMatcher defines the way to match a string.
                                    properties:
                                      contains:
                                        description: |-
                                          Contains defines a substring match on the substring specified here. Empty contains match is not allowed, please use regex instead.
                                          Only one of exact, prefix, suffix, regex or contains can be set.
                                        minLength: 1
                                        type: string
                                      exact:
                                        description: |-
                                          Exact defines an explicit match on the string specified here.
                                          Only one of exact, prefix, suffix, regex or contains can be set.
                                        minLength: 1
                                        type: string
                                      ignoreCase:
                                        default: false
                                        description: IgnoreCase indicates whether the matching should be case-insensitive. In case of a regex match, the regex gets wrapped with a group `(?i:...)`.
                                        type: boolean
                                      prefix:
                                        description: |-
                                          Prefix defines a prefix match on the prefix specified here. Empty prefix is not allowed, please use regex instead.
                                          Only one of exact, prefix, suffix, regex or contains can be set.
                                        minLength: 1
                                        type: string
                                      regex:
                                        description: |-
                                          Regex defines a regex match on the regular expression specified here. Google's [RE2 regex engine](https://github.com/google/re2/wiki/Syntax) is used.
                                          The regex matches only single-line by default, even with ".*". To match a multi-line string prepend (?s) to your regex.
                                          Only one of exact, prefix, suffix, regex or contains can be set.
                                        minLength: 1
                                        type: string
                                      suffix:
                                        description: |-
                                          Suffix defines a suffix match on the suffix specified here. Empty suffix is not allowed, please use regex instead.
                                          Only one of exact, prefix, suffix, regex or contains can be set.
                                        minLength: 1
                                        type: string
                                    type: object
                                required:
                                  - matcher
                                type: object
                            type: object
                          invert:
                            default: false
                            description: Invert indicates whether the request condition should be inverted.
                            type: boolean
                          mediaType:
                            description: MediaType defines the matching media type from the content-type header of a request.
                            properties:
                              matcher:
                                description: |-
                                  NonInvertableCaseInsensitiveStringMatcher defines the way to match a string.
                                  In comparison to a normal StringMatcher, a value is always matched ignoring the case and can't be inverted.
                                properties:
                                  contains:
                                    description: |-
                                      Contains defines a substring match on the substring specified here. Empty contains match is not allowed, please use regex instead.
                                      Only one of exact, prefix, suffix, regex or contains can be set.
                                    minLength: 1
                                    type: string
                                  exact:
                                    description: |-
                                      Exact defines an explicit match on the string specified here.
                                      Only one of exact, prefix, suffix, regex or contains can be set.
                                    minLength: 1
                                    type: string
                                  prefix:
                                    description: |-
                                      Prefix defines a prefix match on the prefix specified here. Empty prefix is not allowed, please use regex instead.
                                      Only one of exact, prefix, suffix, regex or contains can be set.
                                    minLength: 1
                                    type: string
                                  regex:
                                    description: |-
                                      Regex defines a regex match on the regular expression specified here. Google's [RE2 regex engine](https://github.com/google/re2/wiki/Syntax) is used.
                                      The regex matches only single-line by default, even with ".*". To match a multi-line string prepend (?s) to your regex.
                                      Only one of exact, prefix, suffix, regex or contains can be set.
                                    minLength: 1
                                    type: string
                                  suffix:
                                    description: |-
                                      Suffix defines a suffix match on the suffix specified here. Empty suffix is not allowed, please use regex instead.
                                      Only one of exact, prefix, suffix, regex or contains can be set.
                                    minLength: 1
                                    type: string
                                type: object
                            required:
                              - matcher
                            type: object
                          method:
                            description: Method defines the matching methods of a request.
                            items:
                              description: Method defines common HTTP methods.
                              enum:
                                - GET
                                - HEAD
                                - POST
                                - PUT
                                - PATCH
                                - DELETE
                                - CONNECT
                                - OPTIONS
                                - TRACE
                              type: string
                            type: array
                          path:
                            description: Path defines the matching path of a request.
                            properties:
                              matcher:
                                description: StringMatcher defines the way to match a string.
                                properties:
                                  contains:
                                    description: |-
                                      Contains defines a substring match on the substring specified here. Empty contains match is not allowed, please use regex instead.
                                      Only one of exact, prefix, suffix, regex or contains can be set.
                                    minLength: 1
                                    type: string
                                  exact:
                                    description: |-
                                      Exact defines an explicit match on the string specified here.
                                      Only one of exact, prefix, suffix, regex or contains can be set.
                                    minLength: 1
                                    type: string
                                  ignoreCase:
                                    default: false
                                    description: IgnoreCase indicates whether the matching should be case-insensitive. In case of a regex match, the regex gets wrapped with a group `(?i:...)`.
                                    type: boolean
                                  prefix:
                                    description: |-
                                      Prefix defines a prefix match on the prefix specified here. Empty prefix is not allowed, please use regex instead.
                                      Only one of exact, prefix, suffix, regex or contains can be set.
                                    minLength: 1
                                    type: string
                                  regex:
                                    description: |-
                                      Regex defines a regex match on the regular expression specified here. Google's [RE2 regex engine](https://github.com/google/re2/wiki/Syntax) is used.
                                      The regex matches only single-line by default, even with ".*". To match a multi-line string prepend (?s) to your regex.
                                      Only one of exact, prefix, suffix, regex or contains can be set.
                                    minLength: 1
                                    type: string
                                  suffix:
                                    description: |-
                                      Suffix defines a suffix match on the suffix specified here. Empty suffix is not allowed, please use regex instead.
                                      Only one of exact, prefix, suffix, regex or contains can be set.
                                    minLength: 1
                                    type: string
                                type: object
                            required:
                              - matcher
                            type: object
                          remoteIP:
                            description: RemoteIP defines the matching remote IPs of a request.
                            properties:
                              cidrRanges:
                                description: CIDRRanges defines the IPv4 or IPv6 CIDR ranges, e.g. ``196.148.3.128/26`` or ``2001:db8::/28``.
                                items:
                                  description: CIDRRange defines an IPv4 or IPv6 CIDR range, e.g. “196.148.3.128/26“ or “2001:db8::/28“.
                                  format: cidr
                                  type: string
                                minItems: 1
                                type: array
                              invert:
                                default: false
                                description: Invert indicates whether the match should be inverted.
                                type: boolean
                            required:
                              - cidrRanges
                            type: object
                        type: object
                    required:
                      - authorization
                    type: object
                  minItems: 1
                  type: array
              required:
                - policies
              type: object
          required:
            - spec
          type: object
      served: true
      storage: true
      subresources: {}
