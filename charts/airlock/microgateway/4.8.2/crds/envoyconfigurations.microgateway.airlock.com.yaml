apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  labels:
    app.kubernetes.io/name: airlock-microgateway-operator
    app.kubernetes.io/version: 4.8.2
  name: envoyconfigurations.microgateway.airlock.com
spec:
  group: microgateway.airlock.com
  names:
    categories:
      - airlock-microgateway
    kind: EnvoyConfiguration
    listKind: EnvoyConfigurationList
    plural: envoyconfigurations
    singular: envoyconfiguration
  scope: Namespaced
  versions:
    - additionalPrinterColumns:
        - jsonPath: .status.status
          name: Status
          type: string
        - jsonPath: .metadata.creationTimestamp
          name: Age
          type: date
      name: v1alpha1
      schema:
        openAPIV3Schema:
          description: |-
            EnvoyConfiguration represents the raw configuration of an Airlock Microgateway Engine.
            {{% notice warning %}} EnvoyConfiguration resources may contain sensitive information and thus RBAC permissions should be granted with care. {{% /notice %}}
          properties:
            apiVersion:
              description: |-
                APIVersion defines the versioned schema of this representation of an object.
                Servers should convert recognized schemas to the latest internal value, and
                may reject unrecognized values.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
              type: string
            kind:
              description: |-
                Kind is a string value representing the REST resource this object represents.
                Servers may infer this from the endpoint the client submits requests to.
                Cannot be updated.
                In CamelCase.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
              type: string
            metadata:
              type: object
            spec:
              description: spec defines the envoy configuration.
              properties:
                envoyResources:
                  properties:
                    clusters:
                      items:
                        type: object
                        x-kubernetes-preserve-unknown-fields: true
                      type: array
                      x-kubernetes-list-type: atomic
                    endpoints:
                      items:
                        type: object
                        x-kubernetes-preserve-unknown-fields: true
                      type: array
                      x-kubernetes-list-type: atomic
                    extensions:
                      items:
                        type: object
                        x-kubernetes-preserve-unknown-fields: true
                      type: array
                      x-kubernetes-list-type: atomic
                    listeners:
                      items:
                        type: object
                        x-kubernetes-preserve-unknown-fields: true
                      type: array
                      x-kubernetes-list-type: atomic
                    routes:
                      items:
                        type: object
                        x-kubernetes-preserve-unknown-fields: true
                      type: array
                      x-kubernetes-list-type: atomic
                    runtimes:
                      items:
                        type: object
                        x-kubernetes-preserve-unknown-fields: true
                      type: array
                      x-kubernetes-list-type: atomic
                    scopedRoutes:
                      items:
                        type: object
                        x-kubernetes-preserve-unknown-fields: true
                      type: array
                      x-kubernetes-list-type: atomic
                    secrets:
                      items:
                        type: object
                        x-kubernetes-preserve-unknown-fields: true
                      type: array
                      x-kubernetes-list-type: atomic
                  type: object
                envoyResourcesRaw:
                  description: |-
                    envoyResourcesRaw defines the desired state for each resource type. The resources are stored as zstd compressed JSON bytes.
                    For debugging purposes, the resources can be inspected with the following command: `kubectl get envoyconfiguration <name> -ojsonpath='{.spec.envoyResourcesRaw}' | base64 -d | zstd -d | jq`
                  format: byte
                  type: string
                nodeID:
                  description: '**Deprecated:** This field is now ignored as NodeID is always derived from the resource name.'
                  type: string
              type: object
            status:
              description: status describes the current status of the EnvoyConfiguration.
              properties:
                conditions:
                  description: conditions describe the status of the EnvoyConfiguration.
                  items:
                    description: Condition contains details for one aspect of the current state of this API Resource.
                    properties:
                      lastTransitionTime:
                        description: |-
                          lastTransitionTime is the last time the condition transitioned from one status to another.
                          This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                        format: date-time
                        type: string
                      message:
                        description: |-
                          message is a human readable message indicating details about the transition.
                          This may be an empty string.
                        maxLength: 32768
                        type: string
                      observedGeneration:
                        description: |-
                          observedGeneration represents the .metadata.generation that the condition was set based upon.
                          For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                          with respect to the current state of the instance.
                        format: int64
                        minimum: 0
                        type: integer
                      reason:
                        description: |-
                          reason contains a programmatic identifier indicating the reason for the condition's last transition.
                          Producers of specific condition types may define expected values and meanings for this field,
                          and whether the values are considered a guaranteed API.
                          The value should be a CamelCase string.
                          This field may not be empty.
                        maxLength: 1024
                        minLength: 1
                        pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                        type: string
                      status:
                        description: status of the condition, one of True, False, Unknown.
                        enum:
                          - "True"
                          - "False"
                          - Unknown
                        type: string
                      type:
                        description: type of condition in CamelCase or in foo.example.com/CamelCase.
                        maxLength: 316
                        pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                        type: string
                    required:
                      - lastTransitionTime
                      - status
                      - type
                    type: object
                  maxItems: 8
                  type: array
                  x-kubernetes-list-map-keys:
                    - type
                  x-kubernetes-list-type: map
                status:
                  description: status indicates the overall status of the EnvoyConfiguration.
                  enum:
                    - Active
                    - Warning
                    - Error
                  type: string
                xds:
                  description: xds describes the current xDS status for this EnvoyConfiguration.
                  properties:
                    resourceTypes:
                      additionalProperties:
                        description: Synchronization status of a resource type.
                        properties:
                          errorMessage:
                            description: errorMessage indicates the error message provided by the Airlock Microgateway Engine in case the currently served resource version has been rejected.
                            type: string
                          resources:
                            additionalProperties:
                              description: XdsResourceStatus defines the status of xDS for a specific resource
                              properties:
                                version:
                                  description: version defines the version which is currently served for this resource.
                                  maxLength: 128
                                  type: string
                              required:
                                - version
                              type: object
                            description: resources which are currently served for this resource type.
                            type: object
                          status:
                            description: status describes the synchronization status for this resource type.
                            enum:
                              - NotRequested
                              - Pending
                              - Sent
                              - Accepted
                              - Rejected
                            type: string
                          version:
                            description: version which is currently served for this resource type.
                            maxLength: 128
                            type: string
                        required:
                          - resources
                          - status
                          - version
                        type: object
                      description: resourceTypes describes the synchronization status for each resource type.
                      type: object
                    version:
                      description: version indicates the xDS snapshot version.
                      format: int64
                      type: integer
                  required:
                    - version
                  type: object
              type: object
          type: object
      served: true
      storage: true
      subresources:
        status: {}
