apiVersion: storage.k8s.io/v1
kind: CSIDriver
metadata:
  name: {{ include "nutanix-csi-storage.drivername" . }}
  labels:
    {{- include "nutanix-csi-storage.labels" . | nindent 4 }}
spec:
  attachRequired: true
  podInfoOnMount: true
  {{- $existingCSIDriver := lookup "storage.k8s.io/v1" "CSIDriver" "" (include "nutanix-csi-storage.drivername" .) }}
  {{- $fsGroupPolicy := "" }}
  {{- if $existingCSIDriver }}
    {{- $fsGroupPolicy = $existingCSIDriver.spec.fsGroupPolicy }}
  {{- else }}
    {{- $fsGroupPolicy = .Values.fsGroupPolicy | default "File" }}
  {{- end }}
  fsGroupPolicy: {{ $fsGroupPolicy }}